{% extends "layout.html" %}

{% block title %}{{ t('admin_panel') }} - {{ t('app_title') }}{% endblock %}

{% block content %}
<style>
    .admin-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
    }

    .admin-header {
        text-align: center;
        margin-bottom: 2rem;
    }

    .admin-header h1 {
        color: white;
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }

    .admin-header .role-badge {
        display: inline-block;
        background: rgba(255, 255, 255, 0.2);
        padding: 0.5rem 1.5rem;
        border-radius: 25px;
        color: white;
        font-weight: 600;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .stat-card {
        background: white;
        padding: 1.5rem;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        text-align: center;
    }

    .stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        color: #7030A0;
        margin-bottom: 0.5rem;
    }

    .stat-label {
        color: #666;
        font-size: 0.9rem;
    }

    .users-section {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .users-section h2 {
        color: #7030A0;
        margin-bottom: 1.5rem;
    }

    .users-table {
        width: 100%;
        border-collapse: collapse;
    }

    .users-table th {
        background: #7030A0;
        color: white;
        padding: 1rem;
        text-align: left;
        font-weight: 600;
    }

    .users-table td {
        padding: 1rem;
        border-bottom: 1px solid #f0f0f0;
    }

    .users-table tr:hover {
        background: #f8f5fc;
    }

    .role-badge-cell {
        display: inline-block;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.85rem;
    }

    .role-super_admin {
        background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        color: #333;
    }

    .role-director {
        background: linear-gradient(135deg, #7030A0 0%, #9b59d0 100%);
        color: white;
    }

    .role-methodist {
        background: linear-gradient(135deg, #2196F3 0%, #03A9F4 100%);
        color: white;
    }

    .role-teacher {
        background: #e0e0e0;
        color: #666;
    }

    .permission-note {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 1rem;
        margin-top: 1rem;
        border-radius: 8px;
    }

    @media (max-width: 768px) {
        .admin-container {
            padding: 1rem;
        }

        .users-table {
            font-size: 0.85rem;
        }

        .users-table th,
        .users-table td {
            padding: 0.75rem 0.5rem;
        }
    }
</style>

<div class="admin-container">
    <div class="admin-header">
        <h1>
            {% if user.role == 'super_admin' %}
                üëë –°—É–ø–µ—Ä –ê–¥–º–∏–Ω
            {% elif user.role == 'director' %}
                üè¢ –î–∏—Ä–µ–∫—Ç–æ—Ä
            {% else %}
                ‚öôÔ∏è –ê–¥–º–∏–Ω
            {% endif %}
        </h1>
        <div class="role-badge">{{ t(user.role) }}</div>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number">{{ all_users|length }}</div>
            <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">
                {{ all_users|selectattr('role', 'equalto', 'teacher')|list|length }}
            </div>
            <div class="stat-label">–£—á–∏—Ç–µ–ª–µ–π</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">
                {{ all_users|selectattr('role', 'in', ['super_admin', 'director', 'methodist'])|list|length }}
            </div>
            <div class="stat-label">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</div>
        </div>
    </div>

    <div class="users-section">
        <h2>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>

        {% if user.role == 'director' %}
        <div class="permission-note">
            <strong>‚ÑπÔ∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞:</strong>
            –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –§—É–Ω–∫—Ü–∏–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –°—É–ø–µ—Ä –ê–¥–º–∏–Ω—É.
        </div>
        {% endif %}

        <table class="users-table">
            <thead>
                <tr>
                    <th>–§–ò–û</th>
                    <th>Email</th>
                    <th>–®–∫–æ–ª–∞</th>
                    <th>–†–æ–ª—å</th>
                    <th>–ë–∞–ª–ª—ã</th>
                </tr>
            </thead>
            <tbody>
                {% for u in all_users %}
                <tr>
                    <td><strong>{{ u.full_name }}</strong></td>
                    <td>{{ u.username }}</td>
                    <td>{{ u.school }}</td>
                    <td>
                        <span class="role-badge-cell role-{{ u.role }}">
                            {% if u.role == 'super_admin' %}
                                üëë {{ t('super_admin') }}
                            {% elif u.role == 'director' %}
                                üè¢ {{ t('director') }}
                            {% elif u.role == 'methodist' %}
                                üìã {{ t('methodist') }}
                            {% else %}
                                üë®‚Äçüè´ {{ t('teacher') }}
                            {% endif %}
                        </span>
                    </td>
                    <td>
                        {% set user_points = namespace(value=0) %}
                        {% for ach in u.achievements %}
                            {% set user_points.value = user_points.value + ach.points %}
                        {% endfor %}
                        <strong>{{ user_points.value }}</strong>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% if user.role == 'super_admin' %}
    <div class="users-section">
        <h2>üëë –§—É–Ω–∫—Ü–∏–∏ –°—É–ø–µ—Ä –ê–¥–º–∏–Ω–∞</h2>
        <p>–ö–∞–∫ –°—É–ø–µ—Ä –ê–¥–º–∏–Ω, –≤—ã –∏–º–µ–µ—Ç–µ –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å:</p>
        <ul>
            <li>‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</li>
            <li>‚úÖ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π</li>
            <li>‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</li>
            <li>‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–æ–≤</li>
            <li>‚úÖ –ú–æ–¥–µ—Ä–∞—Ü–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</li>
        </ul>
    </div>
    {% elif user.role == 'director' %}
    <div class="users-section">
        <h2>üè¢ –§—É–Ω–∫—Ü–∏–∏ –î–∏—Ä–µ–∫—Ç–æ—Ä–∞</h2>
        <p>–ö–∞–∫ –î–∏—Ä–µ–∫—Ç–æ—Ä, –≤—ã –∏–º–µ–µ—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–∞–≤–∞:</p>
        <ul>
            <li>‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</li>
            <li>‚ùå –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π (—Ç–æ–ª—å–∫–æ –°—É–ø–µ—Ä –ê–¥–º–∏–Ω)</li>
            <li>‚ùå –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç–æ–ª—å–∫–æ –°—É–ø–µ—Ä –ê–¥–º–∏–Ω)</li>
            <li>‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–æ–≤</li>
            <li>‚úÖ –ú–æ–¥–µ—Ä–∞—Ü–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</li>
        </ul>
    </div>
    {% endif %}
</div>

{% endblock %}
